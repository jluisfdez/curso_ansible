Ficheros y OpenSSL II

Ej de file completo:
# cat  journal.yml
- name: Playbook para usar el modulo file para ver si existe o no fichero/directorio
  hosts: localhost
  tasks:
    - name: Crea fich con contenido especificado
      copy: content="Esto es un fihc" dest="/tmp/prueba" backup=yes
    - name: Propiedades fich
      file: path=/tmp/prueba state=absent
            owner=joseluis group=joseluis
    - name: Existe dir
      file:
        path: "/var/log/journal"
        state: absent
        owner: root
        group: systmed-journal
        mode: 2755
      notify: Reiniciar_journald
  handlers:
    - name: Reiniciar_journald
      service: name=systemd-journald state=restarted



- stat: obtiene información del fichero o sistemas de ficheros.

Obligatorios:
  path=/directorio/fichero
Opcionales
  get_attributes=true/fase
  get_checksum=true/fase
  get_md5=true/fase
  get_mime=true/fase

ej:
# Obtener info y guardarla
- stat : path=/etc/services
  register: datos
# Mostrar info:
- debug: var=datos
# Usarlo en condición
- debug: msg: "Es directorio"
  when: datos.stat.isdir


- fetch:  Otra opcion para copiar
Obligatorios:
  src=/directorio/fichero
  dest=/directorio/fichero
Opcionales
  fail_on_missing=no/yes
  flat=no/yes

#Por ejemplo esta tarea copia el interfaces pero con estructura de directorios 
- name: Copiar config red usando fetch
  fetch: src=/etc/network/interfaces dest=/tmp/backupRed/


- unarchive:  Para descomprimir ficheros
Obligatorios:
  src=/directorio/fichero
  dest=/directorio/fichero
Opcionales
  owner=usuario
  group=grupo
  mode=modo
  remote_src=no/yes
  list_files=no/yes

Ej:
- name : copia  y extrae
  unarchive: src=oracle.tgz dest=/opt/oracle 
ó
- name : copia  y extrae que ya existe en nodo remoto
  unarchive: src=/tmp/oracle.tgz dest=/opt/oracle remote_src=true



- lineinfile:  Escribe o quita  lineas en ficheros
Obligatorios:
  line="texto"
  dest=/directorio/fichero
Opcionales
  owner=usuario
  group=grupo
  mode=modo
  backup=no/yes
  insertafter=expresion
  insertbefore=expresion
  regexp=expresion
  state=present/absent

Ej: quita o pone segun elijas state.
# cat  lineInFile.yml
- name: Playbook para usar el modulo lineinfile
  hosts: localhost
  tasks:
    - name: Prueba lineinfile
      lineinfile: line="Canaledjas" dest=/tmp/iba.txt state=absent
    - name: Uso de cat
      command: cat /tmp/iba.txt
      register: salida
    - name: Visualizar variable
      debug: var=salida.stdout_lines

Ej: sustituye Canalejas por Wyomng 
- name: Playbook para usar el modulo lineinfile
  hosts: localhost
  tasks:
    - name: Prueba lineinfile
      lineinfile: line="Wyoming" dest=/tmp/iba.txt regexp="^Canalejas"  state=present
    - name: Uso de cat
      command: cat /tmp/iba.txt
      register: salida
    - name: Visualizar variable
      debug: var=salida.stdout_lines

Ej:  dest=/etc/apache2/ports.conf regexp="^Listen" insertafter="Listen 80" line="Listen 8080"





- blockinfile:  Escribe o quita bloques de lineas en ficheros
Obligatorios:
  block="texto"
  dest=/directorio/fichero
Opcionales
  owner=usuario
  group=grupo
  mode=modo
  backup=no/yes
  insertafter=expresion
  insertbefore=expresion
  marker=marcador
  state=present/absent




- openssl_privatekey:
Obligatorios:
  path=/directorio/fichero
Opcionales
  force=false/true
  size=4096
  state=present/absent
  type=RSA/DSA

- openssl_pubclickey:
Obligatorios:
  path=/directorio/fichero
  privatekey_path=/ruta/fiechero.pem
Opcionales
  force=false/true
  state=present/absent
